---
title: "Analysis of different TV companies involved in the process of TV show making"
author: "Christina Lyu & Sicong Li (using Github^[Github link: https://github.com/ChristinaLyu/miniProject3.git])"
date: "4/26/2018"
output: 
  html_document:
    code_folding: hide
    df_print: paged
    theme: cosmo
---
+1 for using efficient SQL queries (i.e. making use of an index column to speed things up, and including a comment indicating this)

Problem Statement: In this project, we tried to understand the relationship between the average rating of TV shows and the show's production companies. To generate our analysis, we employed database: *imdb* stored on *scidb*.

```{r setup, message = FALSE, warning = FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(mdsr)
library(RMySQL)
library(ggplot2)
library("htmltools")
library("vembedr")
db <- dbConnect_scidb(dbname = "imdb")
class(db)
```

On October 30, 2017, after Kevin Spacey, one of the main casts, was accused by actor Anthony Rapp of making a sexual advance toward him, Netflix announced that the sixth season would be the final season of House of Cards. Originally released in 2013, House of Cards is an American political thriller television series depicting ruthless pragmatism, manipulation, and power with an average rating of 8.9/10 on IMBD. Looking through the production details of House of Cards, we found that it was produced by Trigger Street Productions, which also produced well-known films like Fifty Shades of Grey and The Social Network. Therefore, we are interested in investigating the relationship between the rating of TV shows and the production companies.

```{r message = FALSE, warning = FALSE}
#The TV shows and the production companies with highest reviews ranked by year
tv_rank <- db %>%
  dbGetQuery("SELECT distinct t.id, t.title, t.production_year, n.name,
  mi1.info AS votes, mi2.info AS rating
FROM title t
JOIN movie_info_idx AS mi1 ON mi1.movie_id = t.id
JOIN movie_info_idx AS mi2 ON mi2.movie_id = t.id
join movie_companies as c on c.movie_id = t.id
join company_name as n on n.id = c.company_id
WHERE t.kind_id = 2
  AND mi1.info_type_id = 100
  AND mi2.info_type_id = 101
  AND mi1.info > 100000
ORDER BY t.production_year desc;")
tv_rank
```

Firstly, we wanted to analyze ratings among TV shows with at least 100,000 votes on IMDB. We joined table *movie_info_index* twice so that we could both look at ratings and limit only TV shows with over 100,000 votes show up in our table. After a first glance, we figured out an interesting pattern that it seemed that all of the TV shows that are shown in our table have multiple production companies. Since our table is too large to confirm our hypothesis by just looking through it, we made another table that counts the number of production companies of each TV shows in the previous table.

```{r warning = FALSE, message = FALSE}
#TV shows and how many companies were involved in the production
tv_company <- db %>%
  dbGetQuery("SELECT title, count(distinct name) as count, avg(mi1.info) as avg_votes, avg(mi2.info) as avg_rating, production_year
FROM title t
JOIN movie_info_idx AS mi1 ON mi1.movie_id = t.id
JOIN movie_info_idx AS mi2 ON mi2.movie_id = t.id
join movie_companies as c on c.movie_id = t.id
join company_name as n on n.id = c.company_id
WHERE t.kind_id = 2
  AND mi1.info_type_id = 100
  AND mi2.info_type_id = 101
  AND mi1.info > 100000
GROUP BY title, production_year
order by production_year desc, avg_rating desc")
tv_company
```

The result, not surprisely, is consistent with our guess that all of TV shows with over 100,000 votes are produced by multiple companies. Therefore, we are courious about why a TV show with over 100,000 votes, which indicates that many people have watched that show, gives credits to multiple companies.

We came up with several possible explanations. Essentially, multiple roles are involved in the production of a TV shows. A distributor or a distribution company, for example, promises the network they will guarantee the episode and at times deficit finance the show's and is responsible for marketing the TV shows. In exchange, they own the rights to the show and can monetize it after its initial run. 

```{r warning = FALSE, message = FALSE}
#all the TV shows
tv_all <- 
  db %>%
  dbGetQuery("SELECT distinct t.id, t.title, t.production_year, n.name,
  mi1.info AS votes, mi2.info AS rating
FROM title t
JOIN movie_info_idx AS mi1 ON mi1.movie_id = t.id
JOIN movie_info_idx AS mi2 ON mi2.movie_id = t.id
join movie_companies as c on c.movie_id = t.id
join company_name as n on n.id = c.company_id
WHERE t.kind_id = 2
  AND mi1.info_type_id = 100
  AND mi2.info_type_id = 101
ORDER BY t.production_year desc;")
tv_all
```

```{r}
#all companies with the number of TV shows they produced and the average votes and rating
company_all <- 
  db %>%
  dbGetQuery("SELECT name, count(*) as count, avg(mi1.info) as avg_votes, avg(mi2.info) as avg_rating
FROM title t
JOIN movie_info_idx AS mi1 ON mi1.movie_id = t.id
JOIN movie_info_idx AS mi2 ON mi2.movie_id = t.id
join movie_companies as c on c.movie_id = t.id
join company_name as n on n.id = c.company_id
WHERE t.kind_id = 2
  AND mi1.info_type_id = 100
  AND mi2.info_type_id = 101
  AND production_year = 2017
GROUP BY name
order by avg_rating desc")
company_all
```

```{r warning = FALSE, message = FALSE}
ggplot(data=company_all, aes(x=count, y=avg_rating)) +
  geom_point() + 
  ggtitle("relationship between the number of shows a company produces and their average rating") + 
  theme(plot.title = element_text(size = 10))

```

```{r warning = FALSE, message = FALSE}
#the company that produced the best tv shows and their average rank and votes
company_count <- 
  db %>%
  dbGetQuery("SELECT name, count(*) as number, avg(mi1.info) as avg_votes, avg(mi2.info) as avg_rating
FROM title t
JOIN movie_info_idx AS mi1 ON mi1.movie_id = t.id
JOIN movie_info_idx AS mi2 ON mi2.movie_id = t.id
join movie_companies as c on c.movie_id = t.id
join company_name as n on n.id = c.company_id
WHERE t.kind_id = 2
  AND mi1.info_type_id = 100
  AND mi2.info_type_id = 101
  AND mi1.info > 100000
GROUP BY name
order by number desc")
company_count
```
```{r warning = FALSE, message = FALSE}
#the graph with the number of TV shows a company produced or was involved in the production process, and the average rating it got

company_count %>%
  ggplot(aes(x = number, y = avg_rating)) + 
  geom_point() + 
  geom_smooth() + 
  ggtitle("relationship between the number of shows a company produces and their average rating") + 
  theme(plot.title = element_text(size = 10))

company_all %>%
  ggplot(aes(x = avg_votes, y = avg_rating)) + 
  geom_point() + 
  geom_smooth() + 
  ggtitle("relationship between the average votes of a company on the shows and their average rating") + 
  theme(plot.title = element_text(size = 10))
```


https://www.ranker.com/list/television-production-companies/reference 
Best TV show companies. We could analyze the productions and rates for those companies.


```{r warning = FALSE, message = FALSE}
#the number of TV shows Warner produced
company_warner <- 
  db %>%
  dbGetQuery("SELECT name, count(*) as count, avg(mi1.info) as avg_votes, avg(mi2.info) as avg_rating
FROM title t
JOIN movie_info_idx AS mi1 ON mi1.movie_id = t.id
JOIN movie_info_idx AS mi2 ON mi2.movie_id = t.id
join movie_companies as c on c.movie_id = t.id
join company_name as n on n.id = c.company_id
WHERE t.kind_id = 2
  AND mi1.info_type_id = 100
  AND mi2.info_type_id = 101
  AND name in ('Warner Home Video', '3 Arts Entertainment', '20th Century Fox Television', '20th Century Fox Television', 'ABC Studios', 'ACME Communications', 'Alloy Entertainment', 'American Movie Classics (AMC)', 'Anonymous Content', 'Bad Robot', 'BBC America', 'Beacon Pictures', 'Bunim-Murray Productions', 'CBS Sports', 'Defined Productions', 'Dick Clark Productions', 'eOne Television', 'Eyeboogie, Inc.', 'Filmation', 'FremantleMedia', 'Global Broadcasting', 'LIN TV Corporation', 'Lions Gate Entertainment', 'Lorimar Television', 'Metro-Goldwyn-Mayer', 'Raycom Media', 'Shine America', 'Sony Pictures Television', '
Tribune Entertainment', 'Universal Television', 'Walt Disney Television')
GROUP BY name
order by count desc")
company_warner
```


### Note the production year is different from the year the TV show is actually released. 

```{r warning = FALSE, message = FALSE}

tv_company %>%
  ggplot(aes(y = avg_rating, x = count, color = production_year)) + 
  geom_jitter() + 
  geom_smooth() + 
  ggtitle("relationship between the number of shows a company produces and their average rating") + 
  theme(plot.title = element_text(size = 10))

mod1 <- lm(avg_rating~count+count:production_year, data = tv_company)
summary(mod1)
```


A collection of some famous movie studio logo animations. This video is for promotional purposes only. We do not hold the copyright for the animations. All trademarks and copyrights are the property of their respective owners.


```{r}
embed_url("https://youtu.be/pK_1ApX_31I")
```

































