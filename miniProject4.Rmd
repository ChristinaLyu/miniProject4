---
title: "Analysis of different TV companies involved in the process of TV show making"
author: "Christina Lyu & Sicong Li (using Github^[Github link: https://github.com/ChristinaLyu/miniProject3.git])"
date: "4/26/2018"
output: 
  html_document:
    code_folding: hide
    df_print: paged
    theme: cosmo
---
Problem Statement: In this project, we tried to understand the relationship between the popularity of a TV show and the show's production companies. To generate our analysis, we employed the database *imdb* stored on *scidb*. We also included external resources to provide background information or explanations for our question.

On October 30, 2017, after Kevin Spacey, one of the main casts, was accused by actor Anthony Rapp of making a sexual advance toward him, Netflix announced that the sixth season would be the final season of House of Cards. Originally released in 2013, House of Cards is an American political thriller television series depicting ruthless pragmatism, manipulation, and power with an average rating of 8.9/10 on IMBD. Although it is marked as Netflix original series, after looking through the production details of it, we found that it gives credits to multiple production companies, including Trigger Street Productions, which produced well-known films like Fifty Shades of Grey and The Social Network in the previous years. Therefore, we are interested in investigating the relationship between the popularity of TV shows and the number of production companies: do well-known TV shows are always produced by multiple production companies? If so, what are the underlying explanations for this phenomenon?

```{r setup, message = FALSE, warning = FALSE, result = "hide"}
#setup chunk, running libraries and getting data
knitr::opts_chunk$set(echo = TRUE)
library(mdsr)
library(RMySQL)
library(ggplot2)
library("htmltools")
library("vembedr")
db <- dbConnect_scidb(dbname = "imdb")
class(db)
```

```{r message = FALSE, warning = FALSE}
#The TV shows and the production companies with highest reviews ranked by year with at least 100,000 votes
#used four tables in imdb: movie_info_idx, title, movie_company, company_name
#used index column by using movie_info_idx
tv_rank <- db %>%
  dbGetQuery("SELECT distinct t.id, t.title, t.production_year, n.name,
  mi1.info AS votes, mi2.info AS rating
FROM title t
JOIN movie_info_idx AS mi1 ON mi1.movie_id = t.id
JOIN movie_info_idx AS mi2 ON mi2.movie_id = t.id
join movie_companies as c on c.movie_id = t.id
join company_name as n on n.id = c.company_id
WHERE t.kind_id = 2
#use index column
  AND mi1.info_type_id = 100
  AND mi2.info_type_id = 101
  AND mi1.info > 100000
ORDER BY t.production_year desc;")
tv_rank
```

Firstly, we wanted to analyze ratings among TV shows with at least 100,000 votes on IMDB. After a first glance, we figured out an interesting pattern that it seemed that all of the TV shows that are shown in our table have multiple production companies. Since our table is too large to confirm our guess by looking through it, we created another table that counts the number of production companies of those TV shows.

```{r warning = FALSE, message = FALSE}
#TV shows and how many companies were involved in the production in the TV shows with over 100,000 votes
#used four tables: title, movie_info_idx, movie_companies, company_name
#used index column: movie_info_index, and movie_company.company_id column to join it with company_name.id
tv_company <- db %>%
  dbGetQuery("SELECT title, count(distinct name) as companies, avg(mi1.info) as avg_votes, avg(mi2.info) as avg_rating, production_year
FROM title t
JOIN movie_info_idx AS mi1 ON mi1.movie_id = t.id
JOIN movie_info_idx AS mi2 ON mi2.movie_id = t.id
JOIN movie_companies as c on c.movie_id = t.id
JOIN company_name as n on n.id = c.company_id
WHERE t.kind_id = 2
  AND mi1.info_type_id = 100
  AND mi2.info_type_id = 101
  AND mi1.info > 100000
GROUP BY title, production_year
ORDER by production_year desc, avg_rating desc")
tv_company
```

The result, not surprisingly, is consistent with our guess that all of the TV shows with over 100,000 votes are produced by multiple companies. Therefore, we are curious about why a TV show with over 100,000 votes, which indicates that many people have watched that show, gives credits to multiple companies.

We came up with several possible explanations. Essentially, multiple roles are involved in the production of a TV shows. A distributor or a distribution company, for example, promises the network they will guarantee the episode and at times deficit finance the show's and is responsible for marketing the TV shows. In exchange, they own the rights to the show and can monetize it after its initial run. Distributors can be in different countries, and even be different in the same country but for different platform. Take 13 Reasons Why as an example, while Netflix is the distributor of video and on the internet in the US in 2017, Viacom owns the right to all media now. A TV show also gives credit to its IP owner: toys companies such as Mattel and Lego, Comic books companies such as Marvel. As the TV show is collecting loyalties, it needs to give a logo to those companies.

Secondly, companies may choose to collaborate with other firms to minimize risks. As nobody wants to take a huge gamble by himself, instead of making big bets on high-budget franchise plays, production companies collaborate with other companies to lower the risk. A smaller indie production company may have a good idea, but it needs to seek for financial support to put its idea on screen. In this way, the risk of losing is distributed to several companies, and median to small production companies won't worry that a single investment failure will lead to bankrupt.

Another reason for this phenomena is that many producers, stars, and writers have their studios through which they create and make a show. An example will be Brad Pitt and his production company, Plan-B Entertainment, which won the 86th a best-picture Oscar for *12 Years a Slave*. For those people, they won't sign on to a show unless their production company is hired. That's a way to shield some of their payments from taxation, as the money is technically going to the production company, not themselves.

To confirm our guess, we also created a table that counts the number of TV shows that are less popular (have less than 100 votes in IMDB) and the number of production companies that are given credit to.

```{r warning = FALSE, message = FALSE}
#TV shows and how many companies were involved in the production for shows that are not popular
tv_lesspop <- db %>%
  dbGetQuery("SELECT title, count(distinct name) as companies, avg(mi1.info) as avg_votes, production_year
FROM title t
JOIN movie_info_idx AS mi1 ON mi1.movie_id = t.id
JOIN movie_companies as c on c.movie_id = t.id
JOIN company_name as n on n.id = c.company_id
WHERE t.kind_id = 2
  AND mi1.info_type_id = 100
  AND mi1.info < 100
GROUP BY title, production_year
ORDER by production_year desc")
tv_lesspop
```

The result verifies our idea as most of the TV shows has only 1 or 2 production companies, indicated in the companies column.

```{r warning = FALSE, message = FALSE}
#the number of TV shows 30 largest companies produced
company_warner <- 
  db %>%
  dbGetQuery("SELECT name, count(*) as companies, avg(mi1.info) as avg_votes, avg(mi2.info) as avg_rating
FROM title t
JOIN movie_info_idx AS mi1 ON mi1.movie_id = t.id
JOIN movie_info_idx AS mi2 ON mi2.movie_id = t.id
JOIN movie_companies as c on c.movie_id = t.id
JOIN company_name as n on n.id = c.company_id
WHERE t.kind_id = 2
  AND mi1.info_type_id = 100
  AND mi2.info_type_id = 101
  AND name in ('Warner Home Video', '3 Arts Entertainment', '20th Century Fox Television', '20th Century Fox Television', 'ABC Studios', 'ACME Communications', 'Alloy Entertainment', 'American Movie Classics (AMC)', 'Anonymous Content', 'Bad Robot', 'BBC America', 'Beacon Pictures', 'Bunim-Murray Productions', 'CBS Sports', 'Defined Productions', 'Dick Clark Productions', 'eOne Television', 'Eyeboogie, Inc.', 'Filmation', 'FremantleMedia', 'Global Broadcasting', 'LIN TV Corporation', 'Lions Gate Entertainment', 'Lorimar Television', 'Metro-Goldwyn-Mayer', 'Raycom Media', 'Shine America', 'Sony Pictures Television', '
Tribune Entertainment', 'Universal Television', 'Walt Disney Television')
GROUP BY name
ORDER by avg_rating desc")
company_warner
```

However, there are also disadvantages of the way multiple production companies works. One is that the quality of a show may be affected. An independent TV show is usually low in reward, but it’s also low in risk. As a result, the guiding principle is the creation of quality work, with the hope that commercial and critical success will follow. But in the high-stakes game of millions of dollar investment, TV shows with multiple large production companies involved, the principal aim is return on investment, which means playing it as safe as possible (in both what’s made and how it’s executed), appealing to the widest possible audience, and thus protecting everyone’s investment. 

We generated a table of the top 30 television production companies (data provided: https://www.ranker.com/list/television-production-companies/reference) and the average rating of the TV shows they produced. We figured that the rankings of the best 2 companies (3 Arts Entertainment and 20th Century Fox Television) are all in the middle, indicating that audience may not be satisfied with TV shows produced with the safest way for companies.


```{r warning = FALSE, message = FALSE}
#all the TV shows
tv_all <- 
  db %>%
  dbGetQuery("SELECT distinct t.id, t.title, t.production_year, n.name,
  mi1.info AS votes, mi2.info AS rating
FROM title t
JOIN movie_info_idx AS mi1 ON mi1.movie_id = t.id
JOIN movie_info_idx AS mi2 ON mi2.movie_id = t.id
JOIN movie_companies as c on c.movie_id = t.id
JOIN company_name as n on n.id = c.company_id
WHERE t.kind_id = 2
  AND mi1.info_type_id = 100
  AND mi2.info_type_id = 101
ORDER BY t.production_year desc;")
tv_all
```

```{r warning = FALSE, message = FALSE}
#all companies with the number of TV shows they produced and the average votes and rating
company_all <- 
  db %>%
  dbGetQuery("SELECT name, count(*) as count, avg(mi1.info) as avg_votes, avg(mi2.info) as avg_rating
FROM title t
JOIN movie_info_idx AS mi1 ON mi1.movie_id = t.id
JOIN movie_info_idx AS mi2 ON mi2.movie_id = t.id
JOIN movie_companies as c on c.movie_id = t.id
JOIN company_name as n on n.id = c.company_id
WHERE t.kind_id = 2
  AND mi1.info_type_id = 100
  AND mi2.info_type_id = 101
  AND production_year = 2017
GROUP BY name
ORDER by avg_rating desc")
company_all
```

```{r warning = FALSE, message = FALSE}
ggplot(data=company_all, aes(x=count, y=avg_rating)) +
  geom_point() + 
  ggtitle("relationship between the number of shows a company produces and their average rating") + 
  theme(plot.title = element_text(size = 10))

```

```{r warning = FALSE, message = FALSE}
#the company that produced the best tv shows and their average rank and votes
company_count <- 
  db %>%
  dbGetQuery("SELECT name, count(*) as number, avg(mi1.info) as avg_votes, avg(mi2.info) as avg_rating
FROM title t
JOIN movie_info_idx AS mi1 ON mi1.movie_id = t.id
JOIN movie_info_idx AS mi2 ON mi2.movie_id = t.id
JOIN movie_companies as c on c.movie_id = t.id
JOIN company_name as n on n.id = c.company_id
WHERE t.kind_id = 2
  AND mi1.info_type_id = 100
  AND mi2.info_type_id = 101
  AND mi1.info > 100000
GROUP BY name
ORDER by number desc")
company_count
```


```{r warning = FALSE, message = FALSE}
#the graph with the number of TV shows a company produced or was involved in the production process, and the average rating it got

company_count %>%
  ggplot(aes(x = number, y = avg_rating)) + 
  geom_point() + 
  geom_smooth() + 
  ggtitle("relationship between the number of shows a company produces and their average rating") + 
  theme(plot.title = element_text(size = 10))

company_all %>%
  ggplot(aes(x = avg_votes, y = avg_rating)) + 
  geom_point() + 
  geom_smooth() + 
  ggtitle("relationship between the average votes of a company on the shows and their average rating") + 
  theme(plot.title = element_text(size = 10))
```


https://www.ranker.com/list/television-production-companies/reference 
Best TV show companies. We could analyze the productions and rates for those companies.


```{r warning = FALSE, message = FALSE}

tv_company %>%
  ggplot(aes(y = avg_rating, x = companies, color = production_year)) + 
  geom_jitter() + 
  geom_smooth() + 
  ggtitle("relationship between the number of shows a company produces and their average rating") + 
  theme(plot.title = element_text(size = 10))

mod1 <- lm(avg_rating~companies+companies:production_year, data = tv_company)
summary(mod1)
```

Here is a video^[Youtube video link: https://youtu.be/pK_1ApX_31I] of logos of production companies. See how many you can recognize:
```{r}
embed_url("https://youtu.be/pK_1ApX_31I")
```


































