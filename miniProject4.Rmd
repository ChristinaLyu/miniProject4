---
title: "Analysis of the different TV companies involved in the process of TV show making"
author: "Christina Lyu & Sicong Li (using Github^[Github link: https://github.com/ChristinaLyu/miniProject3.git])"
date: "4/26/2018"
output: 
  html_document:
    code_folding: hide
    df_print: paged
    theme: cosmo
---

Problem Statement:

```{r setup, message = FALSE, warning = FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(mdsr)
library(RMySQL)
library(ggplot2)
db <- dbConnect_scidb(dbname = "imdb")
class(db)
```

On October 30, 2017, after Kevin Spacey, one of the main casts, was accused by actor Anthony Rapp of making a sexual advance toward him, Netflix announced that the sixth season would be the final season of House of Cards. Originally released in 2013, House of Cards is an American political thriller television series depicting ruthless pragmatism, manipulation, and power with an average rating of 8.9/10 on IMBD. Looking through the production details of House of Cards, we found that it was produced by Trigger Street Productions, which also produced well-known films like Fifty Shades of Grey and The Social Network. Therefore, we are interested in investigating the relationship between the rating of TV shows and the production companies.


```{r message = FALSE, warning = FALSE}
#The TV shows and the production companies with highest reviews ranked by year
tv_rank <- db %>%
  dbGetQuery("SELECT distinct t.id, t.title, t.production_year, n.name,
  mi1.info AS votes, mi2.info AS rating
FROM title t
JOIN movie_info_idx AS mi1 ON mi1.movie_id = t.id
JOIN movie_info_idx AS mi2 ON mi2.movie_id = t.id
join movie_companies as c on c.movie_id = t.id
join company_name as n on n.id = c.company_id
WHERE t.kind_id = 2
  AND mi1.info_type_id = 100
  AND mi2.info_type_id = 101
  AND mi1.info > 100000
ORDER BY t.production_year desc;")
tv_rank
```

```{r warning = FALSE, message = FALSE}
#all the TV shows
tv_all <- 
  db %>%
  dbGetQuery("SELECT distinct t.id, t.title, t.production_year, n.name,
  mi1.info AS votes, mi2.info AS rating
FROM title t
JOIN movie_info_idx AS mi1 ON mi1.movie_id = t.id
JOIN movie_info_idx AS mi2 ON mi2.movie_id = t.id
join movie_companies as c on c.movie_id = t.id
join company_name as n on n.id = c.company_id
WHERE t.kind_id = 2
  AND mi1.info_type_id = 100
  AND mi2.info_type_id = 101
ORDER BY t.production_year desc;")
tv_all
```

```{r}
#all companies with the number of TV shows they produced and the average votes and rating
company_all <- 
  db %>%
  dbGetQuery("SELECT name, count(*) as count, avg(mi1.info) as avg_votes, avg(mi2.info) as avg_rating
FROM title t
JOIN movie_info_idx AS mi1 ON mi1.movie_id = t.id
JOIN movie_info_idx AS mi2 ON mi2.movie_id = t.id
join movie_companies as c on c.movie_id = t.id
join company_name as n on n.id = c.company_id
WHERE t.kind_id = 2
  AND mi1.info_type_id = 100
  AND mi2.info_type_id = 101
  AND production_year = 2017
GROUP BY name
order by avg_rating desc")
company_all
```

```{r warning = FALSE, message = FALSE}
  ggplot(data=company_all, aes(x=count, y=avg_rating)) +
  geom_point() + 
  ggtitle("relationship between the number of shows a company produces and their average rating") + 
  theme(plot.title = element_text(size = 10))

```



```{r warning = FALSE, message = FALSE}
#the company that produced the best tv shows and their average rank and votes
company_count <- 
  db %>%
  dbGetQuery("SELECT name, count(*) as number, avg(mi1.info) as avg_votes, avg(mi2.info) as avg_rating
FROM title t
JOIN movie_info_idx AS mi1 ON mi1.movie_id = t.id
JOIN movie_info_idx AS mi2 ON mi2.movie_id = t.id
join movie_companies as c on c.movie_id = t.id
join company_name as n on n.id = c.company_id
WHERE t.kind_id = 2
  AND mi1.info_type_id = 100
  AND mi2.info_type_id = 101
  AND mi1.info > 100000
GROUP BY name
order by number desc")
company_count
```
```{r warning = FALSE, message = FALSE}
#the graph with the number of TV shows a company produced or was involved in the production process, and the average rating it got

company_count %>%
  ggplot(aes(x = number, y = avg_rating)) + 
  geom_point() + 
  geom_smooth() + 
  ggtitle("relationship between the number of shows a company produces and their average rating") + 
  theme(plot.title = element_text(size = 10))

company_all %>%
  ggplot(aes(x = avg_votes, y = avg_rating)) + 
  geom_point() + 
  geom_smooth() + 
  ggtitle("relationship between the average votes of a company on the shows and their average rating") + 
  theme(plot.title = element_text(size = 10))
```



https://www.ranker.com/list/television-production-companies/reference 
Best TV show companies. We could analyze the productions and rates for those companies.


```{r warning = FALSE, message = FALSE}
#the number of TV shows Warner produced
company_warner <- 
  db %>%
  dbGetQuery("SELECT name, count(*) as count, avg(mi1.info) as avg_votes, avg(mi2.info) as avg_rating
FROM title t
JOIN movie_info_idx AS mi1 ON mi1.movie_id = t.id
JOIN movie_info_idx AS mi2 ON mi2.movie_id = t.id
join movie_companies as c on c.movie_id = t.id
join company_name as n on n.id = c.company_id
WHERE t.kind_id = 2
  AND mi1.info_type_id = 100
  AND mi2.info_type_id = 101
  AND name in ('Warner Home Video', '3 Arts Entertainment', '20th Century Fox Television', '20th Century Fox Television', 'ABC Studios', 'ACME Communications', 'Alloy Entertainment', 'American Movie Classics (AMC)', 'Anonymous Content', 'Bad Robot', 'BBC America', 'Beacon Pictures', 'Bunim-Murray Productions', 'CBS Sports', 'Defined Productions', 'Dick Clark Productions', 'eOne Television', 'Eyeboogie, Inc.', 'Filmation', 'FremantleMedia', 'Global Broadcasting', 'LIN TV Corporation', 'Lions Gate Entertainment', 'Lorimar Television', 'Metro-Goldwyn-Mayer', 'Raycom Media', 'Shine America', 'Sony Pictures Television', '
Tribune Entertainment', 'Universal Television', 'Walt Disney Television')
GROUP BY name
order by count desc")
company_warner
```


```{r warning = FALSE, message = FALSE}
#TV shows and how many companies were involved in the production
tv_company <- db %>%
  dbGetQuery("SELECT title, count(distinct name) as count, avg(mi1.info) as avg_votes, avg(mi2.info) as avg_rating, production_year
FROM title t
JOIN movie_info_idx AS mi1 ON mi1.movie_id = t.id
JOIN movie_info_idx AS mi2 ON mi2.movie_id = t.id
join movie_companies as c on c.movie_id = t.id
join company_name as n on n.id = c.company_id
WHERE t.kind_id = 2
  AND mi1.info_type_id = 100
  AND mi2.info_type_id = 101
  AND mi1.info > 100000
GROUP BY title, production_year
order by production_year desc, avg_rating desc")
tv_company
```

### Note the production year is different from the year the TV show is actually released. 

```{r warning = FALSE, message = FALSE}

  tv_company %>%
  ggplot(aes(y = avg_rating, x = count, color = production_year)) + 
  geom_jitter() + 
  geom_smooth() + 
  ggtitle("relationship between the number of shows a company produces and their average rating") + 
  theme(plot.title = element_text(size = 10))

```






































